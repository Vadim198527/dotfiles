
;; -*- lexical-binding: t; -*-

;; –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ package management
(setq evil-want-keybinding nil      ;; ‚Üê –î–û –æ–±—Ä–∞—â–µ–Ω–∏—è –∫¬†evil
      evil-want-integration t
      evil-want-C-u-scroll t
      )
                                        ; ‚îÄ‚îÄ‚îÄ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–µ–ª—ã, –±–µ–∑ —Å–∏–º–≤–æ–ª–∞ TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(setq-default indent-tabs-mode nil)   ;; –Ω–∏–∫–∞–∫–æ–≥–æ \t –≤ —Ñ–∞–π–ª–∞—Ö

;; ‚îÄ‚îÄ‚îÄ —à–∞–≥ –æ—Ç—Å—Ç—É–ø–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(setq-default tab-width 4)            ;; –æ–¥–∏–Ω ¬´–≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ç–∞–±¬ª = 4 –ø—Ä–æ–±–µ–ª–∞
(setq-default evil-shift-width 4)     ;; ‚áê –µ—Å–ª–∏ –ø–æ–ª—å–∑—É–µ—Ç–µ—Å—å evil-shift (>>/<<)


(require 'package)
(global-auto-revert-mode 1)

;; –¢–µ–ø–µ—Ä—å " –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º
(setq select-enable-clipboard nil   ; –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å Clipboard
      select-enable-primary  nil)   ; –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å Primary


(setq auto-revert-use-notify t) 
(setq package-archives '(("melpa" . "https://melpa.org/packages/")
			             ("gnu" . "https://elpa.gnu.org/packages/")))

;; –û—Ç–∫–ª—é—á–∞–µ–º —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –≤–Ω–∏–∑ —ç–∫—Ä–∞–Ω–∞
(setq scroll-conservatively 101)

(setq native-comp-async-report-warnings-errors nil)  ;; –û—Ç–∫–ª—é—á–∏—Ç—å –≤—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
;; –ò–ª–∏, —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —à–∏—Ä–∏–Ω–µ docstring:
(setq native-comp-warning-on-missing-source nil
      native-comp-warning-on-restriction t
      native-comp-always-compile nil
      native-comp-deferred-compilation nil
      native-comp-async-report-warnings-errors 'silent)

;; –í–∫–ª—é—á–∞–µ–º –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
(add-hook 'prog-mode-hook #'display-line-numbers-mode)

;; –í–∫–ª—é—á–∞–µ–º –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ä–µ–∂–∏–º–æ–≤
(add-hook 'text-mode-hook #'display-line-numbers-mode)

;; –û—Å—Ç–∞–≤–ª—è–µ–º –≤–∞—à—É –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ç–∏–ø–∞ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ (—ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
(setq display-line-numbers-type 'relative)

;; –£—Å—Ç–∞–Ω–æ–≤–∫–∞ use-package, –µ—Å–ª–∏ –æ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
(unless (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))

;; –í–∫–ª—é—á–µ–Ω–∏–µ use-package
(eval-when-compile
  (require 'use-package))
(require 'bind-key)
(setq use-package-always-ensure t)

(require 'desktop)
(setq desktop-buffers-not-to-save
      (cons "\\.pdf$" desktop-buffers-not-to-save))
(desktop-save-mode 1)

(use-package exec-path-from-shell
  :if (memq window-system '(mac ns x))
  :config
  (exec-path-from-shell-initialize))

(use-package avy
  :config
  (with-eval-after-load 'evil
    (setq avy-orders-alist
 	      '((avy-goto-char-2 . avy-order-closest)
            (avy-goto-char-timer . avy-order-closest)))
    ;; (global-set-key (kbd "C-/") #'avy-goto-char-2)   ; –≥–ª–æ–±–∞–ª—å–Ω–æ
    (global-set-key (kbd "C-/") #'avy-goto-char-timer)   ; –≥–ª–æ–±–∞–ª—å–Ω–æ
    ;; (global-set-key (kbd "C-/") #'avy-goto-char)   ; –≥–ª–æ–±–∞–ª—å–Ω–æ

    )
  )

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
(use-package modus-themes
  :init
  ;; –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π —Ç–µ–º—ã
  (setq modus-themes-italic-constructs t
        modus-themes-bold-constructs nil
        modus-themes-to-toggle '(modus-operandi modus-vivendi)
        modus-themes-common-palette-overrides
        '((bg-mode-line-active bg-sage)
          (fg-mode-line-active fg-main)
          (border-mode-line-active bg-green-intense)
          (bg-tab-bar bg-main)
          (bg-tab-current bg-active)
          (bg-tab-other bg-dim)
          (fringe unspecified)
          (underline-link unspecified)
          (underline-link-visited unspecified)
          (underline-link-symbolic unspecified)
          (fg-completion-match-0 blue)
          (fg-completion-match-1 magenta-warmer)
          (fg-completion-match-2 cyan)
          (fg-completion-match-3 red)
          (bg-completion-match-0 bg-blue-nuanced)
          (bg-completion-match-1 bg-magenta-nuanced)
          (bg-completion-match-2 bg-cyan-nuanced)
          (bg-completion-match-3 bg-red-nuanced)
          (comment yellow-faint)
          (string green-warmer)
          (prose-done green-faint)
          (prose-todo red-faint)))
  :config
  (load-theme 'modus-operandi :no-confirm)
  (define-key global-map (kbd "<f12>") #'modus-themes-toggle))
;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤
(set-face-attribute 'default nil :family "Iosevka Nerd Font" :height 155)
(set-face-attribute 'variable-pitch nil :family "Iosevka Aile")

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∏ org-mode
(use-package org
  :ensure nil
  :hook
  (org-mode . org-indent-mode)
  :config
  (setq org-auto-align-tags nil
        org-tags-column 0
        org-catch-invisible-edits 'show-and-error
        org-special-ctrl-a/e t
        org-hide-emphasis-markers t
        org-ellipsis "‚Ä¶"
        org-agenda-files (directory-files-recursively "~/docs" "\\.org$")
        org-agenda-tags-column 0
        org-agenda-block-separator ?‚îÄ
        org-agenda-time-grid '((daily today require-timed)
			                   (800 1000 1200 1400 1600 1800 2000)
			                   " ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ " "‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ")
        org-agenda-current-time-string "‚óÄ‚îÄ‚îÄ now ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
        org-format-latex-options (plist-put org-format-latex-options :scale 1.9)))

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ yasnippet
(use-package yasnippet
  :config
  (setq yas-snippet-dirs '("~/.emacs.d/snippets"))
  (yas-global-mode 1)
  ;; ;; ;; –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ–º –Ω–∞ M-<tab>
  (define-key yas-minor-mode-map (kbd "<tab>") yas-maybe-expand)
  )

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cdlatex
(use-package cdlatex
  :hook ((LaTeX-mode . turn-on-cdlatex)
         (org-mode . turn-on-org-cdlatex)
	     (cdlatex-mode . my-cdlatex-disable-keys))
  :config
  (defun my-cdlatex-disable-keys ()
    ;; —É–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–ø–∞—Ä—É –¥–ª—è "(" –∏ ")"
    (define-key cdlatex-mode-map (kbd "(") nil)
    (define-key cdlatex-mode-map (kbd ")") nil)
    (define-key cdlatex-mode-map (kbd "<") nil)
    (define-key cdlatex-mode-map (kbd "|") nil)
    ;; —É–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∞–ø–æ—Å—Ç—Ä–æ—Ñ–∞
    (define-key cdlatex-mode-map (kbd "'") nil)))

(defun my-latex-mode-keybindings ()
  "Custom keybindings for LaTeX mode."
  ;; –í–∞—à–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –¥–ª—è –æ—Ç—Å—Ç—É–ø–æ–≤
  (local-set-key (kbd "C-c i") 'indent-for-tab-command)
  ;; –ù–æ–≤–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ Evil normal state
  ;; <leader>cv —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "compile view" (–∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é)
  )

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AUCTeX
(use-package tex
  :ensure auctex
  :defer t
  :custom
  (LaTeX-indent-level       4)
  ;; –æ—Ç—Å—Ç—É–ø –≤–Ω—É—Ç—Ä–∏ {‚Ä¶}
  (TeX-brace-indent-level   4)
  ;; –æ—Ç—Å—Ç—É–ø –¥–ª—è \item
  (LaTeX-item-indent        0)
  :hook ((LaTeX-mode . (lambda () (TeX-fold-mode 1)))
	     (LaTeX-mode . my-latex-mode-keybindings)
         (LaTeX-mode . visual-line-mode)
         (LaTeX-mode . LaTeX-math-mode)
         (LaTeX-mode . turn-on-reftex)
         (LaTeX-mode . my-latex-mode-keybindings)
	     (LaTeX-mode . (lambda ()
			             ;;  ùìî ùìó ùìò ùìô ùìö ùìõ ùìú ùìù ùìû  ùì† ùì° ùì¢ ùì£ ùì§ ùì• ùì¶ ùìß ùì® ùì©
                         (dolist (pair
                                  '(("\\blank"      . ?‚Äî)
                                    ("\\otimes"     . ?‚®Ç)
                                    ("\\defeq"      . ?‚âî)
                                    ("\\mathcal{A}" . ?ùìê)
                                    ("\\mathcal{B}" . ?ùìë)
                                    ("\\mathcal{C}" . ?ùìí)
                                    ("\\mathcal{D}" . ?ùìì )
                                    ("\\mathcal{G}" . ?ùìñ )
                                    ("\\mathcal{F}" . ?ùìï )
                                    ("\\mathcal{P}" . ?ùìü )
                                    ("\\mathrm{A}" . ?A )
                                    ("\\mathrm{B}" . ?B )
                                    ("\\mathrm{C}" . ?C )
                                    ("\\mathrm{D}" . ?D )
                                    ("\\mathrm{E}" . ?E )
                                    ("\\mathrm{L}" . ?L )
                                    ("\\mathrm{P}" . ?P )
                                    ("\\mathrm{R}" . ?R )
                                    ("\\mathrm{S}" . ?S )
                                    ("\\mathrm{T}" . ?T )
                                    ("\\mathrm{X}" . ?X )
                                    ("\\mathrm{Y}" . ?Y )
                                    ("\\mathrm{Z}" . ?Z )
                                    ("\\!\\upharpoonright" . ?‚Üæ )
                                    ("\\implies" . ?‚áí )
                                    ("\\land" . ?‚àß)
                                    ("\\lor" . ?‚à®)
                                    ("\\varnothing" . ?‚àÖ)
                                    ("\\cat{C}"     . ?ùìí)))
                           (push pair prettify-symbols-alist))
                         (prettify-symbols-mode 1))))
  :config
  (setopt TeX-fold-macro-spec-list '(("{1}" ("emph" "text"))))
  (setq TeX-auto-save t)
  (setq TeX-parse-self t)
  ;; (add-hook 'LaTeX-mode-hook 'TeX-global-PDF-mode)
  (setq-default TeX-PDF-mode t)
  ;; (setq TeX-engine 'latexmk)
  (setq TeX-engine 'luatex)



  ;; -------------------------
  (add-hook 'LaTeX-mode-hook #'TeX-source-correlate-mode)
  (setq TeX-source-correlate-start-server t)
  (setq TeX-view-program-selection '((output-pdf "PDF Tools")))
  (setq TeX-view-program-list '(("PDF Tools" TeX-pdf-tools-sync-view)))
  )
(setq-default TeX-engine 'xetex) ; –∏–ª–∏ 'luatex

(use-package pdf-tools
  :defer t
  :magic ("%PDF")
  :config
  ;; –®–ê–ì 1: "–û–±–º–∞–Ω—ã–≤–∞–µ–º" –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.
  ;; –ú—ã —É–¥–∞–ª—è–µ–º display-line-numbers-mode –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Ä–µ–∂–∏–º–æ–≤.
  (setq pdf-view-incompatible-modes
        (remove 'display-line-numbers-mode pdf-view-incompatible-modes))

  ;; –®–ê–ì 2: "–ù–∞–≤–æ–¥–∏–º –ø–æ—Ä—è–¥–æ–∫", –æ—Ç–∫–ª—é—á–∞—è —Ä–µ–∂–∏–º, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º –Ω–µ –Ω—É–∂–µ–Ω.
  ;; –≠—Ç–æ—Ç —Ö—É–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Ç–∏—Ö–æ –≤—ã–∫–ª—é—á–∏—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫.
  (add-hook 'pdf-view-mode-hook #'display-line-numbers-mode-off-in-pdf)
  (defun display-line-numbers-mode-off-in-pdf ()
    "–û—Ç–∫–ª—é—á–∞–µ—Ç display-line-numbers-mode –≤ –±—É—Ñ–µ—Ä–∞—Ö PDF."
    (display-line-numbers-mode -1))

  ;; --- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∞—à–∏ —Ä–∞–±–æ—á–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ---
  (pdf-tools-install :no-query)
  (setq-default pdf-view-display-size 'fit-width)
  (add-hook 'TeX-after-compilation-finished-functions
            #'TeX-revert-document-buffer))

;; –ü—Ä–∏–≤—è–∑–∫–∞ –∫–ª–∞–≤–∏—à –≤ —Ä–µ–∂–∏–º–µ LaTeX
(with-eval-after-load 'evil
  (evil-define-key 'normal LaTeX-mode-map
    (kbd "<leader>cv") 'my-latex-compile-and-view))

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ aas
(use-package aas
  :hook ((LaTeX-mode . aas-activate-for-major-mode)
         (org-mode . aas-activate-for-major-mode)
         (TeX-mode . aas-activate-for-major-mode))
  :config
  (defun my/real-math-p ()
    "–ò—Å—Ç–∏–Ω–Ω–æ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ $‚Ä¶$, \\(‚Ä¶\\), \\[‚Ä¶\\] –∏–ª–∏ *—Ä–µ–∞–ª—å–Ω–æ–≥–æ* math‚Äëenv."
    (let ((info (texmathp)))
      (and info
           (memq (car info)         ; –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç ¬´–≥–¥–µ¬ª –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è
		         '(in-dollar in-paren in-env)))))
  (aas-set-snippets 'text-mode
                    ";o-" "≈ç"
                    ";i-" "ƒ´"
                    ";a-" "ƒÅ"
                    ";u-" "≈´"
                    ";e-" "ƒì")
  (aas-set-snippets 'org-mode
                    ";latex" (lambda ()
	                           (interactive)
	                           (yas-expand-snippet (yas-lookup-snippet "latexCode")))
                    ;; –î–æ–±–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–Ω–∏–ø–ø–µ—Ç—ã –∑–¥–µ—Å—å
                    )
  (aas-set-snippets 'LaTeX-mode
                    "mk" (lambda ()
	                       (interactive)
	                       (yas-expand-snippet (yas-lookup-snippet "makeMathEnv")))
                    "dm" (lambda ()
	                       (interactive)
	                       (yas-expand-snippet (yas-lookup-snippet "makeMathBlockEnv")))

                    "RR" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\mathbb{R} ")
	                         (insert "$\\mathbb{R}$ ")))
                    ";A" "$\\mathrm{A}$"
                    ";B" "$\\mathrm{B}$"
                    ";L" "$\\mathrm{L}$"
                    ";P" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\mathrm{P}")
	                         (insert "$\\mathrm{P}$")))
                    ";R" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\mathrm{R}")
	                         (insert "$\\mathrm{R}$")))
                    ";S" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\mathrm{S}")
	                         (insert "$\\mathrm{S}$")))
                    ";T" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\mathrm{T}")
	                         (insert "$\\mathrm{T}$")))

                    ";X" (lambda ()
	                       (interactive)
	                       (if (not (texmathp)) 
	                           (insert "$\\mathrm{X}$")
	                         ))

                    ";Y" "$\\mathrm{Y}$"
                    ";Z" (lambda ()
	                       (interactive)
	                       (if (not (texmathp)) 
	                           (insert "$\\mathrm{Z}$")
	                         ))


                    ",F" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\mathcal{F}")
	                         (insert "$\\mathcal{F}$")))
                    ",G" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\mathcal{G}")
	                         (insert "$\\mathcal{G}$")))
                    ",R" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\mathcal{R}")
	                         (insert "$\\mathcal{R}$")))
                    ",P" "$\\mathcal{P}$"


                    "=>" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\implies")
	                         (insert "$\\implies$")))

                    "->" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\to ")
	                         (insert "$\\to $ ")))

                    "!=" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\neq ")
	                         (insert "$\\neq$")))
                    "OO" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\varnothing ")
	                         (insert "$\\varnothing$ ")))
                    "CC" (lambda ()
	                       (interactive)
	                       (if (texmathp) 
	                           (insert "\\subseteq ")
	                         (insert "$\\subseteq$ ")))

                    ";CC" (lambda ()
	                        (interactive)
	                        (if (texmathp) 
		                        (insert "\\supseteq")
	                          (insert "$\\supseteq$")))


                    ;; "oo" (lambda ()
                    ;; 	   (interactive)
                    ;; 	   (if (texmathp)
                    ;; 	       (insert "\\circ ")))

                    :cond #'texmathp
                    "oo" "\\circ "
                    "AA" "\\forall "
                    "EE" "\\exists "
                    "EU" "\\exists! "
                    "inn" "\\in "
                    "iff" "\\iff "
                    "&&" "\\land"
                    "||" "\\lor"
                    "o+" "\\oplus "
                    "==" "&= "
                    ">=" "\\ge"
                    "<=" "\\le"
                    "**" "\\cdot "

                    "nn" "\\cap "

                    "xx" "\\times "

                    "rct" "\\!\\upharpoonright "
                    "txt" (lambda ()
	                        (interactive)
	                        (yas-expand-snippet (yas-lookup-snippet "text")))
                    ))



;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ org-roam
(use-package org-roam
  :custom
  (org-roam-directory "~/Desktop/org-roam")
  :bind (("C-c n l" . org-roam-buffer-toggle)
         ("C-c n f" . org-roam-node-find)
         ("C-c n i" . org-roam-node-insert))
  :config
  (org-roam-setup))

(use-package vterm)

(setq evil-undo-system 'undo-fu)  ; Move this up top for global consistency, before evil loads.

;; –±–∞–∑–æ–≤–æ–µ Ctrl-Z / Ctrl-Shift-Z –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ Emacs
(use-package undo-fu
  :ensure t
  :bind (("C-z"   . undo-fu-only-undo)
         ("C-S-z" . undo-fu-only-redo)))

;; –ü–∏—à–µ–º –∏—Å—Ç–æ—Ä–∏—é –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
(use-package undo-fu-session
  :after undo-fu
  :ensure t
  :init
  ;; –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è undo-—Ñ–∞–π–ª–æ–≤ (—Å–µ—Å—Å–∏–π). –ï—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
  (setq undo-fu-session-directory
        (expand-file-name "undo-fu-history/" user-emacs-directory))
  ;; –ò—Å–∫–ª—é—á–µ–Ω–∏—è: –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–µ—Å—Å–∏–∏ –¥–ª—è —ç—Ç–∏—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (–¥–æ–±–∞–≤–∏–ª–∏ .el –¥–ª—è config-—Ñ–∞–π–ª–æ–≤).
  (setq undo-fu-session-incompatible-files
        '("/COMMIT_EDITMSG\\'" "/git-rebase-todo\\'" "\\.gpg\\'" "\\.png\\'" "\\.jpg\\'" "\\.el\\'"))
  ;; –°–∂–∞—Ç–∏–µ —Ñ–∞–π–ª–æ–≤ —Å–µ—Å—Å–∏–π –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ (zstd ‚Äî –±—ã—Å—Ç—Ä–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ; –º–æ–∂–Ω–æ —Å–º–µ–Ω–∏—Ç—å –Ω–∞ 'xz –∏–ª–∏ nil).
  (setq undo-fu-session-compression 'zstd)
  ;; –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç—ã –¥–∞–ª—å—à–µ, —á—Ç–æ–±—ã —Ä–µ–∂–µ —É—Ä–µ–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é.
  (setq undo-limit 16000000         ; 16 MB: –º—è–≥–∫–∏–π –ª–∏–º–∏—Ç
        undo-strong-limit 24000000  ; 24 MB: —Å–∏–ª—å–Ω—ã–π –ª–∏–º–∏—Ç
        undo-outer-limit 128000000  ; 128 MB: –∂—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –≤–∏–Ω–æ–≤–Ω–∏–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
        undo-ask-before-discard t)  ; –°–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–µ—Ä–µ–¥ discard –∫—Ä—É–ø–Ω–æ–≥–æ undo (–¥–∞—ë—Ç —à–∞–Ω—Å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å).
  :config
  ;; –í–∫–ª—é—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ: —Å–µ—Å—Å–∏–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è/–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –¥–ª—è –≤—Å–µ—Ö –±—É—Ñ–µ—Ä–æ–≤.
  (undo-fu-session-global-mode 1)
  ;; –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π) –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ Emacs, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ö–ª–∞–º–ª—è—Ç—å –¥–∏—Å–∫.
  (add-hook 'kill-emacs-hook
            (lambda ()
              (let ((days 7))
                (dolist (file (directory-files undo-fu-session-directory t))
                  (when (and (file-regular-p file)
                             (> (float-time (time-subtract (current-time) (nth 5 (file-attributes file))))
                                (* days 86400)))  ; 86400 —Å–µ–∫ = 1 –¥–µ–Ω—å
                    (delete-file file)))))))

;; —Å–∞–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
(use-package vundo
  :ensure t
  :bind (("C-x u" . vundo))  ; –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞.
  :init
  ;; –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
  (setq vundo-roll-back-on-quit t       ; –û—Ç–∫–∞—Ç –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ.
        vundo-glyph-alist vundo-unicode-symbols  ; Unicode-—Å–∏–º–≤–æ–ª—ã –¥–ª—è –¥–µ—Ä–µ–≤–∞.
        vundo-compact-display t         ; –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥ –¥–µ—Ä–µ–≤–∞ (–º–µ–Ω—å—à–µ –º–µ—Å—Ç–∞).
        vundo-window-max-height 10)     ; –õ–∏–º–∏—Ç –≤—ã—Å–æ—Ç—ã –æ–∫–Ω–∞ vundo.
  :config
  ;; –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Evil: –≤ normal-state vundo –∏—Å–ø–æ–ª—å–∑—É–µ–º vim-–ø–æ–¥–æ–±–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏.
  (with-eval-after-load 'evil
    (evil-define-key 'normal vundo-mode-map
      (kbd "h") #'vundo-backward
      (kbd "l") #'vundo-forward
      (kbd "j") #'vundo-next
      (kbd "k") #'vundo-previous
      (kbd "RET") #'vundo-confirm
      (kbd "q") #'vundo-quit))
  ;; –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å diff –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
  )

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ evil-mode (—É–±—Ä–∞–ª–∏ undo-tree —Å—Å—ã–ª–∫–∏, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –Ω–∞ undo-fu)
(use-package evil
  :ensure t
  :init
  (setq evil-disable-insert-state-bindings t)
  (setq evil-undo-system 'undo-fu)  ; –Ø–≤–Ω–æ undo-fu –∑–¥–µ—Å—å.
  ;; ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—É—Ä—Å–æ—Ä–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  :config
  (evil-mode 1)
  (evil-select-search-module 'evil-search 'evil-search)
  (setq evil-ex-search-persistent-highlight nil)
  (evil-set-leader nil (kbd "SPC"))
  (defun my/lisp-symbol-words ()
    ;; –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—É—Ñ–µ—Ä–µ paredit'–∞
    (defalias #'forward-evil-word #'forward-evil-symbol))
  (add-hook 'paredit-mode-hook #'my/lisp-symbol-words)
  ;; –ü—Ä–∏–≤—è–∑–∫–∞ –¥–ª—è vundo –≤–º–µ—Å—Ç–æ undo-tree (–∏–∑–º–µ–Ω–∏—Ç–µ, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ undo-tree-visualize).
  (evil-define-key 'normal 'global (kbd "<leader>ut") 'vundo)
  ;; ‚îÄ‚îÄ‚îÄ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ vi$ / va$ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  (evil-define-text-object my/evil-dollar-inner (count &optional beg end type)
    "–í–∑—è—Ç—å —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É –±–ª–∏–∂–∞–π—à–∏–º–∏ $ ‚Ä¶ $."
    (evil-select-quote ?$ beg end type count))
  (evil-define-text-object my/evil-dollar-outer (count &optional beg end type)
    "–í–∑—è—Ç—å –≤–º–µ—Å—Ç–µ —Å –¥–æ–ª–ª–∞—Ä–∞–º–∏."
    (evil-select-quote ?$ beg end type count t))
  (define-key evil-inner-text-objects-map "$" #'my/evil-dollar-inner)
  (define-key evil-outer-text-objects-map "$" #'my/evil-dollar-outer))



;; (use-package evil-collection
;;   :after evil
;;   :ensure t
;;   :init
;;   (evil-collection-init)
;;   (evil-collection-org-setup)
;;   ;; :config
;;   ;; (add-hook 'org-agenda-mode-hook 'evil-normal-state)
;;   )

(use-package evil-collection
  :after evil
  :ensure t
  :init
  ;; –≤–∫–ª—é—á–∞–µ–º Evil –≤ minibuffer‚Äô–µ –∏ –≤–æ –≤—Å–µ—Ö ¬´–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö¬ª –±—É—Ñ–µ—Ä–∞—Ö
  (setq evil-collection-setup-minibuffer t)
  (evil-collection-init)          ;; ‚Üê –¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏ –ø–æ—Å–ª–µ set-q
  (evil-collection-org-setup))


;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ vertico
(use-package vertico
  :demand t  ;; –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø–∞–∫–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—è
  :init
  (vertico-mode)  ;; –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  :bind (:map minibuffer-local-map
	          ("C-n" . vertico-next)
	          ("C-p" . vertico-previous)))

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ consult
(use-package consult
  :ensure t
  :after recentf
  :config
  ;; (setq consult-project-root-function #'projectile-project-root)
  (evil-define-key 'normal 'global (kbd "<leader>,") 'consult-buffer)
  (evil-define-key 'normal 'global (kbd "<leader>fg") 'consult-grep)
  (evil-define-key 'normal 'global (kbd "<leader>SPC") 'consult-recent-file)
  (evil-define-key 'normal 'global (kbd "<leader>oa") 'org-agenda))

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ embark –∏ embark-consult
(use-package embark
  :bind (("C-." . embark-act))
  :init
  (setq prefix-help-command #'embark-prefix-help-command))

(use-package embark-consult
  :after (embark consult)
  :hook (embark-collect-mode . consult-preview-at-point-mode))

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ savehist
(use-package savehist
  :init
  (savehist-mode))

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ expand-region
(use-package expand-region
  :bind (("C-=" . er/expand-region)))

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ recentf
(use-package recentf
  :ensure nil
  :init
  (recentf-mode 1)
  :custom
  (recentf-max-saved-items 100))

(use-package evil-surround
  :ensure t
  :config
  (global-evil-surround-mode 1))

;; –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –∏ –∑–≤—É–∫–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
(setq inhibit-startup-message t)
;; (setq visible-bell t)
(setq ring-bell-function 'ignore)

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –æ–∫–æ–Ω
(defun other-window-backward (&optional n)
  "Select Nth previous window."
  (interactive "P")
  (other-window (- (prefix-numeric-value n))))

(defun other-window-forward (&optional n)
  "Select Nth next window."
  (interactive "P")
  (other-window (prefix-numeric-value n)))

;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
(defun scroll-n-lines-ahead (&optional n)
  "Scroll N lines ahead."
  (interactive "P")
  (scroll-up (prefix-numeric-value n)))

(defun scroll-n-lines-behind (&optional n)
  "Scroll N lines behind."
  (interactive "P")
  (scroll-down (prefix-numeric-value n)))



(use-package lsp-mode
  :ensure t
  :commands lsp
  :hook ((python-mode . lsp)
	     (c-mode . lsp)) ; –∑–∞–ø—É—Å–∫ lsp –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ python-—Ñ–∞–π–ª–æ–≤
  :init
  ;; –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  (setq lsp-keymap-prefix "C-c l") ; –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–∞–º lsp
  (setq lsp-log-io t)
  ;; (with-eval-after-load 'lsp-mode
  ;;   (setq lsp-pylsp-plugins-pylint-args '("--disable=C0111")))

  :config
  ;; –î–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫—ç—à
  (setq lsp-enable-file-watchers nil))
;;;; ‚îÄ‚îÄ‚îÄ Pyright ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(use-package lsp-pyright
  :ensure t                 ;; —Å–∫–∞—á–∞–µ—Ç –ø–∞–∫–µ—Ç —Å MELPA
  :after lsp-mode           ;; –ø–æ–¥–≥—Ä—É–∑–∏—Ç—Å—è –ø–æ—Å–ª–µ lsp-mode
  :init
  ;; –ø–æ–ª–µ–∑–Ω—ã–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ) –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  (setq lsp-pyright-typechecking-mode "basic"      ; –∏–ª–∏ "strict"
        lsp-pyright-auto-import-completions t
        lsp-pyright-use-library-code-for-types t)
  :hook
  ;; –≤ Python-–±—É—Ñ–µ—Ä–µ –ø–æ–¥–≥—Ä—É–∂–∞–µ–º lsp-pyright –∏ –∑–∞–ø—É—Å–∫–∞–µ–º lsp
  ;; (lsp-deferred —Å—Ç–∞—Ä—Ç—É–µ—Ç —Å–µ—Ä–≤–µ—Ä –ª–µ–Ω–∏–≤–æ, —á—É—Ç—å —É—Å–∫–æ—Ä—è–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞)
  (python-mode . (lambda ()
                   (require 'lsp-pyright)
                   (lsp-deferred)))
  :config
  (with-eval-after-load 'lsp-mode
    (setq lsp-disabled-clients '(pyls pylsp mspyls jedi)))

  )
;;;; ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

(use-package lsp-ui
  :ensure t
  :commands lsp-ui-mode
  :init
  (add-hook 'lsp-mode-hook 'lsp-ui-mode))

(use-package clang-format
  :ensure t
  :bind (:map c-mode-map
	          ("C-c f" . clang-format-region)))


;;; --- Corfu --------------------------------------------------------------
(use-package corfu
  :custom
  (corfu-auto t) (corfu-cycle t)
  (corfu-auto-prefix 2) (corfu-auto-delay 0)
  (corfu-preselect 'prompt)
  :init
  (setq corfu-excluded-modes '(latex-mode LaTeX-mode))
  (global-corfu-mode)
  (corfu-popupinfo-mode) (corfu-history-mode)
  :config (keymap-unset corfu-map "TAB"))

;; Optionally use the `orderless' completion style.
(use-package orderless
  :init
  (setq completion-styles '(orderless basic)
        completion-category-defaults nil
        completion-category-overrides '((file (styles . (partial-completion)))
					                    (command (styles orderless basic))
					                    (variable (styles orderless basic))
					                    (symbol (styles orderless basic)))
        orderless-component-separator "[ -]"))

;; https://www.racket-mode.com/#Install-Update-and-Uninstall 
(use-package racket-mode
  :mode ("\\.rkt\\'")
  :hook (racket-mode . racket-xp-mode)
  :config
  (evil-define-key 'normal racket-mode-map (kbd "<leader>de") '(lambda () (interactive)
								                                 (racket-xp-mode t)))
  (evil-define-key 'normal racket-mode-map (kbd "<leader>dd") '(lambda () (interactive) 
								                                 (racket-xp-mode -1))))
;; –£–¥–æ–±–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Lisp-–∫–æ–¥–∞ (—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
(use-package paredit
  :config
  (dolist (m '(emacs-lisp-mode-hook
	           racket-mode-hook
	           racket-repl-mode-hook))
    (add-hook m #'paredit-mode)) 
  (evil-define-key 'normal paredit-mode-map (kbd "<)") 'paredit-forward-slurp-sexp)
  (evil-define-key 'normal paredit-mode-map (kbd ">)") 'paredit-forward-barf-sexp)
  (evil-define-key 'normal paredit-mode-map (kbd ">(") 'paredit-backward-slurp-sexp)
  (evil-define-key 'normal paredit-mode-map (kbd "<(") 'paredit-backward-barf-sexp)
  (evil-define-key 'normal paredit-mode-map (kbd "|") 'paredit-split-sexp)
  (evil-define-key 'normal paredit-mode-map (kbd "<leader>jn") 'paredit-join-sexps)
  ;; (evil-define-key 'normal paredit-mode-map (kbd "<leader>(") 'paredit-wrap-round)
  (evil-define-key 'normal paredit-mode-map (kbd "<leader>d(") 'paredit-splice-sexp)
  (evil-define-key 'normal paredit-mode-map (kbd "C-f") 'paredit-forward)
  (evil-define-key 'normal paredit-mode-map (kbd "C-b") 'paredit-backward)
  (evil-define-key 'normal paredit-mode-map (kbd "<leader>bu") 'paredit-backward-up)
  (evil-define-key 'normal paredit-mode-map (kbd "<leader>bd") 'paredit-backward-down)
  (evil-define-key 'normal paredit-mode-map (kbd "<leader>fu") 'paredit-forward-up)
  (evil-define-key 'normal paredit-mode-map (kbd "<leader>fd") 'paredit-forward-down)
  (evil-define-key 'insert paredit-mode-map (kbd "RET") 'paredit-newline)
  (evil-define-key 'insert paredit-mode-map (kbd "C-k") 'paredit-newline)
  (evil-define-key 'normal racket-repl-mode (kbd "C-h") 'evil-window-left)  
  (evil-define-key 'insert racket-repl-mode (kbd "C-h") 'evil-window-left)  
  (evil-define-key 'insert paredit-mode-map (kbd "C-h") 'paredit-backward-delete))


(use-package cmuscheme
  :ensure nil               ;; —Ç.–∫. —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç Emacs
  :commands (run-scheme)    ;; –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ M-x run-scheme
  :config
  ;; –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è Scheme ‚Äî —ç—Ç–æ MIT Scheme
  (setq scheme-program-name "mit-scheme")

  ;; –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–∏ M-x run-scheme —Å–æ–∑–¥–∞–≤–∞–ª—Å—è
  ;; –±—É—Ñ–µ—Ä —Å –∏–º–µ–Ω–µ–º "MIT Scheme" –≤–º–µ—Å—Ç–æ "*scheme*":
  (setq cmuscheme-name "MIT Scheme"))

(use-package evil-mc
  :after evil
  :config
  (global-evil-mc-mode 1)
  ;; (evil-define-key 'normal evil-mc-key-map (kbd "C-n") #'evil-mc-make-and-goto-next-cursor)
  (with-eval-after-load 'evil-mc
    ;; –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º C-n –∫ –∫–æ–º–∞–Ω–¥–µ evil-mc-make-and-goto-next-match –≤ normal state
    (evil-define-key 'normal evil-mc-key-map (kbd "C-n") #'evil-mc-make-and-goto-next-match)
    ;; (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è visual state
    (evil-define-key 'visual evil-mc-key-map (kbd "C-n") #'evil-mc-make-and-goto-next-match)
    (evil-define-key 'normal evil-mc-key-map (kbd "<leader>cl") #'evil-mc-undo-all-cursors)
    ))

;; –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ package.el
(use-package evil-goggles
  :ensure t
  :config
  ;; –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ä–µ–∂–∏–º
  (evil-goggles-mode)
  
  ;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
  (setq evil-goggles-duration 0.040)
  
  ;; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ yank
  (custom-set-faces
   '(evil-goggles-yank-face ((t (:background "#00afff" :foreground "black")))))
  
  ;; –í–∫–ª—é—á–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø—É–ª—å—Å–∞—Ü–∏–∏
  (setq evil-goggles-pulse t)
  
  ;; –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é yank, —á—Ç–æ–±—ã –∫—É—Ä—Å–æ—Ä –æ—Å—Ç–∞–≤–∞–ª—Å—è –Ω–∞ –º–µ—Å—Ç–µ
  (defun my/evil-yank-with-cursor-stay (orig-fun beg end &optional type register yank-handler)
    "–û–±–µ—Ä—Ç–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è evil-yank, –∫–æ—Ç–æ—Ä–∞—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞."
    (let ((pos (point)))
      (funcall orig-fun beg end type register yank-handler)
      (goto-char pos)))
  
  ;; –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—à —Å–æ–≤–µ—Ç –∫ —Ñ—É–Ω–∫—Ü–∏–∏ evil-yank
  (advice-add 'evil-yank :around #'my/evil-yank-with-cursor-stay)
  
  ;; –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è visual-—Ä–µ–∂–∏–º–∞
  (defun my/evil-visual-yank-with-cursor-stay (orig-fun beg end &optional type register)
    "–û–±–µ—Ä—Ç–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è evil-visual-yank, –∫–æ—Ç–æ—Ä–∞—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞."
    (let ((pos (point)))
      (funcall orig-fun beg end type register)
      (goto-char pos)))
  
  (advice-add 'evil-yank-lines :around #'my/evil-visual-yank-with-cursor-stay))

(require 'use-package)
(setq use-package-always-ensure t)


(use-package treemacs
  :ensure t
  :defer t                               ; –Ω–µ –≥—Ä—É–∑–∏—Ç—Å—è, –ø–æ–∫–∞ –Ω–µ –≤—ã–∑–æ–≤–µ—Ç–µ
  :init
  ;; <leader> t ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å / —Å–∫—Ä—ã—Ç—å –¥–µ—Ä–µ–≤–æ
  (with-eval-after-load 'evil
    (evil-define-key 'normal 'global (kbd "<leader>t") #'treemacs)) ; ¬´treemacs¬ª —É–∂–µ —É–º–µ–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å

  :config
  ;; –Ω–µ–º–Ω–æ–≥–æ –∫–æ—Å–º–µ—Ç–∏–∫–∏ (–º–µ–Ω—è–π—Ç–µ –ø–æ –≤–∫—É—Å—É)
;;;; ‚îÄ‚îÄ‚îÄ C-h/j/k/l —Ä–∞–±–æ—Ç–∞—é—Ç –∏ –≤ Treemacs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  (with-eval-after-load 'treemacs-evil      ; –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Å–æ–∑–¥–∞–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ treemacs
    (with-eval-after-load 'evil
      ;; <leader> t –≤–Ω—É—Ç—Ä–∏ treemacs-state
      (evil-define-key 'treemacs treemacs-mode-map
	    (kbd "<leader>t") #'treemacs)             ; ‚Üê –¥–æ–±–∞–≤–∏–ª–∏!
      (dolist (state '(treemacs normal))    ; –¥—É–±–ª–∏—Ä—É–µ–º –≤ –æ–±–∞
	    (evil-define-key state treemacs-mode-map
          (kbd "C-h") #'evil-window-left
          (kbd "C-l") #'evil-window-right
          (kbd "C-j") #'evil-window-down
          (kbd "C-k") #'evil-window-up))))
;;;; ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  (setq treemacs-width                 35
        treemacs-show-hidden-files      t
        treemacs-follow-after-init      t
        treemacs-filewatch-mode         t
        treemacs-git-mode              'deferred)

  ;; –≤–∫–ª—é—á–∞–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã
  (treemacs-follow-mode          1)
  (treemacs-filewatch-mode       1)
  (treemacs-fringe-indicator-mode 'always))

;; Evil-—Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –∫–ª–∞–≤–∏—à–∏ –≤–Ω—É—Ç—Ä–∏ –æ–∫–Ω–∞ Treemacs
(use-package treemacs-evil
  :after (treemacs evil))

;; –ï—Å–ª–∏ –ø–æ–ª—å–∑—É–µ—Ç–µ—Å—å Projectile / project.el
(use-package treemacs-projectile
  :after (treemacs projectile))


;;;; ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(use-package harpoon
  :ensure t                ;; –±–µ—Ä—ë–º –∏–∑ MELPA
  :custom
  ;; 1) –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–µ–∫—Ç–æ–≤
  (harpoon-project-package nil)       ;; ‚Üí –±—É—Ñ–µ—Ä —Å—á–∏—Ç–∞–µ—Ç—Å—è ¬´–≤–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞¬ª
  ;; 2) –Ω–µ –ø–ª–æ–¥–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –Ω–∞ git-–≤–µ—Ç–∫–∏
  (harpoon-separate-by-branch nil)
  ;; 3) –∞ –∫–æ–≥–¥–∞ ¬´–≤–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞¬ª ‚Äî –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  ;;    –û–î–ù–û –∏ —Ç–æ –∂–µ –∏–º—è –∫–µ—à-—Ñ–∞–π–ª–∞ (–∑–¥–µ—Å—å: "global")
  (harpoon-without-project-function (lambda () "global"))
  ;; :bind
  ;; (("<leader>;"       . harpoon-quick-menu-hydra)  ;; –º–µ–Ω—é —Å–±–æ–∫—É
  ;;  ("<leader>ha"   . harpoon-add-file)          ;; –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª
  ;;  ;; –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø—Ä—ã–∂–∫–∏
  ;;  ("C-c h 1" . harpoon-go-to-1)
  ;;  ("C-c h 2" . harpoon-go-to-2)
  ;;  ("C-c h 3" . harpoon-go-to-3)
  ;;  ("C-c h 4" . harpoon-go-to-4)
  ;;  ("C-c h 5" . harpoon-go-to-5)
  ;;  ("C-c h 6" . harpoon-go-to-6)
  ;;  ("C-c h 7" . harpoon-go-to-7)
  ;;  ("C-c h 8" . harpoon-go-to-8)
  ;;  ("C-c h 9" . harpoon-go-to-9))
  :config 
  (evil-define-key 'normal 'global (kbd "<leader>;") #'harpoon-quick-menu-hydra)
  (evil-define-key 'normal 'global (kbd "<leader>a h") #'harpoon-add-file))

(custom-set-variables
 ;; custom-set-variables was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(custom-safe-themes
   '("0a2168af143fb09b67e4ea2a7cef857e8a7dad0ba3726b500c6a579775129635"
     "4594d6b9753691142f02e67b8eb0fda7d12f6cc9f1299a49b819312d6addad1d"
     "51fa6edfd6c8a4defc2681e4c438caf24908854c12ea12a1fbfd4d055a9647a3"
     "99d1e29934b9e712651d29735dd8dcd431a651dfbe039df158aa973461af003e"
     "0517759e6b71f4ad76d8d38b69c51a5c2f7196675d202e3c2507124980c3c2a3"
     "9a977ddae55e0e91c09952e96d614ae0be69727ea78ca145beea1aae01ac78d2"
     "e410458d3e769c33e0865971deb6e8422457fad02bf51f7862fa180ccc42c032"
     "48042425e84cd92184837e01d0b4fe9f912d875c43021c3bcb7eeb51f1be5710"
     "3f1dcd824a683e0ab194b3a1daac18a923eed4dba5269eecb050c718ab4d5a26"
     "8ccbbbf5c197f80c9dce116408a248fde1ac4fedd9b5b7883e729eba83c9c64e"
     default))
 '(evil-emacs-state-modes
   '(5x5-mode bbdb-mode biblio-selection-mode blackbox-mode
              bookmark-edit-annotation-mode browse-kill-ring-mode
              bs-mode bubbles-mode bzr-annotate-mode calc-mode
              cfw:calendar-mode completion-list-mode
              custom-theme-choose-mode delicious-search-mode
              desktop-menu-blist-mode desktop-menu-mode dun-mode
              dvc-bookmarks-mode dvc-diff-mode dvc-info-buffer-mode
              dvc-log-buffer-mode dvc-revlist-mode dvc-revlog-mode
              dvc-status-mode dvc-tips-mode ediff-mode ediff-meta-mode
              efs-mode Electric-buffer-menu-mode emms-browser-mode
              emms-mark-mode emms-metaplaylist-mode emms-playlist-mode
              ess-help-mode etags-select-mode fj-mode gc-issues-mode
              gdb-breakpoints-mode gdb-disassembly-mode
              gdb-frames-mode gdb-locals-mode gdb-memory-mode
              gdb-registers-mode gdb-threads-mode gist-list-mode
              git-rebase-mode gomoku-mode google-maps-static-mode
              jde-javadoc-checker-report-mode magit-cherry-mode
              magit-diff-mode magit-log-mode magit-log-select-mode
              magit-popup-mode magit-popup-sequence-mode
              magit-process-mode magit-reflog-mode magit-refs-mode
              magit-revision-mode magit-stash-mode magit-stashes-mode
              magit-status-mode mh-folder-mode monky-mode mpuz-mode
              mu4e-main-mode mu4e-headers-mode mu4e-view-mode
              notmuch-hello-mode notmuch-search-mode notmuch-show-mode
              notmuch-tree-mode org-agenda-mode proced-mode rcirc-mode
              rebase-mode recentf-dialog-mode sldb-mode
              slime-inspector-mode slime-thread-control-mode
              slime-xref-mode snake-mode solitaire-mode
              sr-buttons-mode sr-mode sr-tree-mode sr-virtual-mode
              tetris-mode tla-annotate-mode tla-archive-list-mode
              tla-bconfig-mode tla-bookmarks-mode tla-branch-list-mode
              tla-browse-mode tla-category-list-mode
              tla-changelog-mode tla-follow-symlinks-mode
              tla-inventory-file-mode tla-inventory-mode tla-lint-mode
              tla-logs-mode tla-revision-list-mode tla-revlog-mode
              tla-tree-lint-mode tla-version-list-mode twittering-mode
              urlview-mode vc-annotate-mode vc-dir-mode vm-mode
              vm-summary-mode w3m-mode wab-compilation-mode
              xgit-annotate-mode xgit-changelog-mode xgit-diff-mode
              xgit-revlog-mode xhg-annotate-mode xhg-log-mode xhg-mode
              xhg-mq-mode xhg-mq-sub-mode xhg-status-extra-mode))
 '(helm-minibuffer-history-key "M-p")
 '(package-selected-packages
   '(0x0 aas atomic-chrome auctex cape catppuccin-theme cdlatex
         clang-format claude-code corfu embark-consult evil-collection
         evil-goggles evil-leader evil-mc evil-surround
         exec-path-from-shell expand-region gruvbox-theme harpoon hop
         iedit lsp-pyright lsp-ui marginalia modus-themes orderless
         org-roam paredit pdf-tools pos-tip racket-mode treemacs-evil
         treemacs-icons-dired treemacs-projectile treesit-auto undo-fu
         undo-fu-session vertico vterm vundo yasnippet))
 '(package-vc-selected-packages
   '((claude-code :url "https://github.com/stevemolitor/claude-code.el")
     (pcre :url "https://github.com/syohex/emacs-pcre.git" :branch
           "master")
     (hop :url "https://github.com/Animeshz/hop.el.git" :branch "main")))
 '(warning-suppress-types '((use-package))))

(custom-set-faces
 ;; custom-set-faces was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(evil-goggles-yank-face ((t (:background "#00afff" :foreground "black")))))

 (load-file "~/dotfiles/emacs/.emacs.d/config.el")

